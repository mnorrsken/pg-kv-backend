# Default values for postkeys
replicaCount: 1

image:
  repository: ghcr.io/mnorrsken/postkeys
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext:
  # capabilities:
  #   drop:
  #   - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

service:
  type: ClusterIP
  port: 6379

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Enable debug logging (sets DEBUG=1)
debug: false

# SQL query tracing level (sets SQLTRACE=0-3)
# 0 = off (default)
# 1 = important only (DDL, TRUNCATE, errors)
# 2 = most queries (INSERT, UPDATE, DELETE)
# 3 = everything (including SELECT)
# WARNING: Higher levels output more queries to logs - use only for debugging
sqlTraceLevel: 0

# RESP command tracing level (sets TRACE=0-3)
# 0 = off (default)
# 1 = important only (AUTH, FLUSHDB, CONFIG, CLUSTER)
# 2 = most commands (excludes GET, SET, and other high-frequency commands)
# 3 = everything (including GET, SET, HGET, HSET, etc.)
# WARNING: Higher levels output more commands to logs - use only for debugging
traceLevel: 0

# Redis server configuration
redis:
  # Address to listen on (inside the container)
  addr: ":6379"
  
  # Redis password configuration
  password:
    # Enable creation of a Redis password secret using a Helm hook Job
    # If enabled and no existingSecret is provided, a random password will be generated
    # The password.value field is ignored when create is true
    create: false
    # Name of the secret to create (only used if create is true and no existingSecret)
    secretName: "postkeys-secret"
    # Password value (only used if create is false and no existingSecret is set)
    # When create is true, this value is ignored and a random password is generated
    value: ""
    # Secret generator Job configuration (only used when create is true)
    secretGenerator:
      # Image configuration for the secret generator Job
      image:
        repository: rancher/kubectl
        tag: "v1.35.0"
        pullPolicy: IfNotPresent
    # Use an existing secret for the Redis password
    existingSecret:
      # Name of the existing secret
      name: ""
      # Key in the secret containing the password
      key: "redis-password"

# PostgreSQL connection configuration
postgresql:
  # PostgreSQL host
  host: "postgresql"
  # PostgreSQL port
  port: 5432
  # PostgreSQL database name
  database: "postkeys"
  # PostgreSQL SSL mode (disable, require, verify-ca, verify-full)
  sslmode: "disable"
  
  # Use an existing secret for PostgreSQL credentials
  existingSecret:
    # Name of the existing secret
    name: ""
    # Key in the secret containing the username (optional)
    usernameKey: ""
    # Key in the secret containing the password
    passwordKey: "password"
    # Key in the secret containing the host (optional)
    hostKey: ""
    # Key in the secret containing the port (optional)
    portKey: ""
    # Key in the secret containing the database name (optional)
    databaseKey: ""
  
  # Authentication configuration
  auth:
    # PostgreSQL username (ignored if existingSecret provides it)
    username: "postgres"
    # PostgreSQL password (ignored if existingSecret is set)
    password: ""

# Additional environment variables
extraEnv: []
  # - name: MY_VAR
  #   value: "my-value"

# Additional environment variables from secrets/configmaps
extraEnvFrom: []
  # - secretRef:
  #     name: my-secret
  # - configMapRef:
  #     name: my-configmap

# Metrics configuration
metrics:
  # Enable metrics endpoint
  enabled: true
  # Metrics server address (inside the container)
  addr: ":9090"
  
  # Metrics service configuration
  service:
    # Port for the metrics service
    port: 9090
    # Annotations for the metrics service
    annotations: {}
  
  # ServiceMonitor configuration (requires Prometheus Operator)
  serviceMonitor:
    # Enable ServiceMonitor creation
    enabled: false
    # Namespace for the ServiceMonitor (defaults to release namespace)
    namespace: ""
    # Labels to add to the ServiceMonitor
    labels: {}
    # Interval at which metrics should be scraped
    interval: "30s"
    # Timeout for scraping metrics
    scrapeTimeout: "10s"
    # Metric relabel configs
    metricRelabelings: []
    # Relabel configs
    relabelings: []
    # Honor labels
    honorLabels: false

# Cache configuration (for string GET operations)
cache:
  # Enable in-memory cache (opt-in, disabled by default)
  enabled: false
  # Cache TTL - how long to cache values (e.g., "100ms", "1s", "5s")
  # With distributed invalidation, longer TTLs are safe and improve performance
  # Without distributed invalidation, use shorter TTLs (100-500ms) to limit stale reads
  ttl: "250ms"
  # Maximum number of cached entries (0 = unlimited)
  maxSize: 10000
  # Enable distributed cache invalidation via PostgreSQL LISTEN/NOTIFY
  # Required for cache coherency in multi-pod deployments
  # Adds ~0.3ms overhead per write operation
  # For single-pod deployments, leave disabled and use short TTL
  distributedInvalidation: false
